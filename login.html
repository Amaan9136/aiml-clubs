<!DOCTYPE html>
<html>

<head>
<title>Club Login</title>
<link rel="icon" href="img/AIML LOGO WHITE.png" type="png" />

<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="format-detection" content="telephone=no" />
<meta name="HandheldFriendly" content="true" />
<meta name="MobileOptimized" content="320" />

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="css/header.css" />
<link rel="stylesheet" href="css/form.css" />

<style>
  body,
  html {
    margin: 0;
    padding: 0;
    min-height: 100vh;
    position: relative;
  }

  body::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgb(31, 31, 31);
    /* Set background with opacity */
    z-index: -1;
  }

  .form-box {
    position: relative;
    top: 50px;
    margin: 0 auto;
    margin-bottom: 10px;
    border: 2px solid white;
    border-radius: 10px;
    max-width: 350px;
  }

  p.form-label {
    padding: 0px;
    padding-bottom: 8px;
  }

  @media (min-width: 768px) {
    .form-box {
      max-width: 500px;
    }
  }

  .header-logo {
      border-radius: 0px;
    }
</style>
</head>

<body>
<header class="header">
  <div class="text-white">
    <img class="header-logo" src="img/AIML LOGO WHITE.png" alt="Logo" />
    TECH-CLUB
  </div>
  <nav class="header-menu-for-desktop">
    <div class="dropdown text-white">
      <a href="index.html" class="text-white a-text">Home</a>
      <button class="dropbtn text-white">Clubs ▼</button>
      <div class="dropdown-content marg">
        <!-- add links to respective club website -->
        <a href="TechClub/index.html" class="text-white a-text">Technical Club</a>
        <a href="CulturalClub/index.html" class="text-white a-text">Cultural Club</a>
        <a href="SocialClub/index.html" class="text-white a-text">Social Club</a>
        <a href="SportsClub/index.html" class="text-white a-text">Sports Club</a>
      </div>
      <a href="#" class="text-white a-text">Login</a>
      <a href="register.html" class="text-white a-text">Register</a>
      <a href="contact.html" class="text-white a-text">Contact Us</a>
      <!-- add more -->
    </div>
  </nav>

  <div class="header-menu-for-mobile">
    <img src="img/menu.png" alt="Menu" onclick="toggleMenu()" />
    <div class="menu-items">
      <a href="index.html" class="text-white a-text">Home</a>
      <div class="dropdown text-white">
        <!-- add links to respective club website -->
        <button class="dropbtn text-white a-text" style="margin-left: 10px;">Clubs ▼</button>
        <div class="dropdown-content ">
          <a href="TechClub/index.html" class="text-white a-text">>Technical Club</a>
          <a href="CulturalClub/index.html" class="text-white a-text">>Cultural Club</a>
          <a href="SocialClub/index.html" class="text-white a-text">>Social Club</a>
          <a href="SportsClub/index.html" class="text-white a-text">>Sports Club</a>
        </div>
      </div>
      <hr class="hr-menu" />
      <a href="#" class="text-white a-text">Login</a>
      <a href="register.html" class="text-white a-text">Register</a>
      <a href="contact.html" class="text-white a-text">Contact Us</a>
      <!-- add more -->
    </div>
  </div>
</header>

<div class="form-content">
  <!-- Main content goes here -->

  <div class="form-box">
    <p class="form-label">Login Here!</p>

    <div id="alert-div2">
      <div id="alert-message2" class="alert alert-success fade show" role="alert"></div>
    </div>
    <div id="alert-div1">
      <div id="alert-message1" class="alert text-danger bg-white fade show" role="alert"></div>
    </div>

    <form action="php/login.php" method="POST" class="form" id="login-form">
      <label for="UsnOrMobile" class="form-label">Phone Number / USN:</label>
      <input type="text" id="UsnOrMobile" name="UsnOrMobile" class="form-input" required
        placeholder="Enter your Phone / USN" oninput="this.value = this.value.toUpperCase();" /><br />

      <label for="password" class="form-label">Password:</label>
      <input type="password" id="password" name="password" class="form-input" required
        placeholder="Enter your Password" /><br />

      <div class="form-buttons">
        <input type="submit" value="Login" class="form-submit" />
        <input type="button" value="Reset" class="form-submit reset-btn" onclick="resetForm()" />
      </div>
      <div style="text-align: center; margin-top: 8px">
        <a href="contact.html">Forget Password?</a>
      </div>
    </form>
  </div>
</div>

<!-- header js -->
<script>
  window.addEventListener('contextmenu', function (e) {
    e.preventDefault(); // Prevent right-click menu
});
  // Function to toggle mobile menu
  function toggleMenu() {
    var menuItems = document.querySelector(".menu-items");
    var menuIcon = document.querySelector(".header-menu-for-mobile img");

    menuItems.classList.toggle("show");
    menuIcon.src = menuItems.classList.contains("show")
      ? "img/menuclose.png"
      : "img/menu.png";

    var menuTextItems = document.querySelectorAll(".menu-items a"); // Define menuTextItems here

    if (menuItems.classList.contains("show")) {
      for (var i = 0; i < menuTextItems.length; i++) {
        menuTextItems[i].style.display = "block";
      }
    } else {
      for (var i = 0; i < menuTextItems.length; i++) {
        menuTextItems[i].style.display = "none";
      }
    }
  }

  var dropdownButtons = document.getElementsByClassName("dropbtn");
  var dropdownContents =
    document.getElementsByClassName("dropdown-content");

  for (var i = 0; i < dropdownButtons.length; i++) {
    var dropdownButton = dropdownButtons[i];
    var dropdownContent = dropdownContents[i];

    dropdownButton.addEventListener("click", function (event) {
      event.stopPropagation();
      toggleDropdown(this.nextElementSibling);
    });

    dropdownButton.addEventListener("mouseover", function (event) {
      toggleDropdown(this.nextElementSibling);
    });

    dropdownContent.addEventListener("mouseover", function (event) {
      toggleDropdown(this);
    });
  }

  document.addEventListener("mousemove", function (event) {
    var dropdowns = document.getElementsByClassName("dropdown-content");
    var isInsideDropdown = false;

    for (var i = 0; i < dropdowns.length; i++) {
      var dropdown = dropdowns[i];

      if (dropdown.contains(event.target)) {
        isInsideDropdown = true;
        break;
      }
    }

    if (!isInsideDropdown && !isCloseToDropdown(event)) {
      closeDropdowns();
    }
  });

  document.addEventListener("click", function (event) {
    var dropdowns = document.getElementsByClassName("dropdown-content");
    var isInsideDropdown = false;

    for (var i = 0; i < dropdowns.length; i++) {
      var dropdown = dropdowns[i];

      if (dropdown.contains(event.target)) {
        isInsideDropdown = true;
        break;
      }
    }

    if (!isInsideDropdown) {
      closeDropdowns();
    }
  });

  function toggleDropdown(dropdown) {
    closeDropdowns();

    if (dropdown.style.display === "none") {
      dropdown.style.display = "block";
    }
  }

  function closeDropdowns() {
    var dropdowns = document.getElementsByClassName("dropdown-content");

    for (var i = 0; i < dropdowns.length; i++) {
      var dropdown = dropdowns[i];
      dropdown.style.display = "none";
    }
  }

  function isCloseToDropdown(event) {
    var dropdowns = document.getElementsByClassName("dropdown-content");

    for (var i = 0; i < dropdowns.length; i++) {
      var dropdown = dropdowns[i];
      var dropdownRect = dropdown.getBoundingClientRect();
      var mouseX = event.clientX;
      var mouseY = event.clientY;

      if (
        mouseX >= dropdownRect.left - 50 &&
        mouseX <= dropdownRect.right + 50 &&
        mouseY >= dropdownRect.top - 50 &&
        mouseY <= dropdownRect.bottom + 50
      ) {
        return true;
      }
    }

    return false;
  }

  // Event listener to close the mobile menu when clicked outside
  document.addEventListener("click", function (event) {
    var menuItems = document.querySelector(".menu-items");
    var menuIcon = document.querySelector(".header-menu-for-mobile img");

    if (menuItems.classList.contains("show")) {
      if (
        !event.target.closest(".header-menu-for-mobile") &&
        !event.target.closest(".menu-items")
      ) {
        menuItems.classList.remove("show");
        var menuTextItems = document.querySelectorAll(".menu-items a");
        for (var i = 0; i < menuTextItems.length; i++) {
          menuTextItems[i].style.display = "none";
        }
        menuIcon.src = "img/menu.png";
        menuIcon.classList.remove("hide"); // Show the menu button
      }
    }
  });

  function resetForm() {
    // Get all input elements inside the form, excluding option fields and buttons
    var form = document.getElementById("login-form");
    var inputElements = form.querySelectorAll(
      "input[type='text'], input[type='email'], input[type='tel'], input[type='password']"
    );

    // Loop through each input element and reset its value
    for (var i = 0; i < inputElements.length; i++) {
      inputElements[i].value = "";
    }
  }
</script>

<script>
  const loginForm = document.querySelector("#login-form");
  const alertDiv1 = document.querySelector("#alert-div1");
  const alertMessage1 = document.querySelector("#alert-message1");
  const alertDiv2 = document.querySelector("#alert-div2");
  const alertMessage2 = document.querySelector("#alert-message2");

  document.addEventListener("DOMContentLoaded", function () {
    // Function to show the alert message
    function showAlert(message, isSuccess) {
      var alertDiv;
      if (isSuccess) {
        alertDiv = document.getElementById("alert-message2"); // Success alert
      } else {
        alertDiv = document.getElementById("alert-message1"); // Error alert
      }
      alertDiv.textContent = message;
      alertDiv.style.display = "block";
      setTimeout(function () {
        alertDiv.style.display = "none";
      }, 3000); // Hide the message after 3 seconds (adjust as needed)
    }

    if (alertMessage1.innerHTML.trim() === "")
      alertDiv1.classList.add("no-content");
    if (alertMessage2.innerHTML.trim() === "")
      alertDiv2.classList.add("no-content");

    if (loginForm) {
      loginForm.addEventListener("submit", async (event) => {
        event.preventDefault();
        const UsnOrMobile = loginForm.elements.UsnOrMobile.value;
        const password = loginForm.elements.password.value;

        const loginData = { UsnOrMobile, password };

        try {
          const loginResponse = await fetch("php/login.php", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(loginData),
          });
          const data = await loginResponse.json();

          if (data.success) {
            showAlert(data.message, true);
            alertDiv1.classList.add("no-content");
            // No need to add a setTimeout here, it's already handled in showAlert
            setTimeout(() => (window.location.href = "profile.html"), 1000);
          } else showAlert(data.message);
        } catch (error) {
          console.error(error);
          showAlert("Cannot Login!");
        }
      });
    }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
  crossorigin="anonymous"></script>
</body>

</html>